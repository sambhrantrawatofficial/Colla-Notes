@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    var Username = HttpContextAccessor.HttpContext.Session.GetString("username");
}
@{
    ViewData["Title"] = ViewBag.Title;
}

<div class="container mt-6 mb-10 max-w-4xl">

    <!-- TITLE -->
    <div class="mb-6">
        <h1 class="text-4xl md:text-5xl font-bold tracking-tight leading-tight">
            @ViewBag.Title
        </h1>

        <!-- META -->
        <div class="mt-3 flex items-center gap-6 text-lg text-gray-500">
            <span class="flex items-center gap-1">
                👁️ <strong class="text-gray-800">@ViewBag.Views</strong>
            </span>
            <span class="flex items-center gap-1">
                👍 <strong class="text-gray-800">@ViewBag.Likes</strong>
            </span>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="prose prose-lg max-w-none leading-relaxed text-gray-800">
        @Html.Raw(ViewBag.Description)
    </div>

    <hr class="my-8" />

    <!-- LIKE SECTION -->
    <div class="mb-8">
        @if (ViewBag.AlreadyLiked == true)
        {
            <button class="btn btn-secondary rounded-full px-6 py-2 text-lg" disabled>
                👍 Liked
            </button>
        }
        else
        {
            <form asp-controller="Home"
                  asp-action="Like"
                  asp-route-id="@ViewBag.id"
                  method="post"
                  class="inline-block">
                <button class="btn btn-outline-primary rounded-full px-6 py-2 text-lg hover:shadow-md transition">
                    👍 Like this post
                </button>
            </form>
        }
    </div>

    <!-- ADD COMMENT -->
    <div class="mb-10">
        <h3 class="text-2xl font-bold mb-3">💬 Join the discussion</h3>

        <form asp-controller="Home"
              asp-action="AddComment"
              asp-route-id="@Context.Request.RouteValues["id"]"
              method="post">
            <textarea name="commentText"
                      class="form-control rounded-xl shadow-sm border-2 focus:ring-indigo-500 focus:border-indigo-500"
                      rows="3"
                      placeholder="Share your thoughts..."
                      required></textarea>

            <button class="btn btn-primary rounded-full px-6 py-2 mt-3 text-lg shadow hover:shadow-lg transition">
                Comment
            </button>
        </form>
    </div>

    <!-- COMMENTS LIST -->
    <div class="mb-10">
        <h3 class="text-2xl font-bold mb-4">Comments</h3>

        @if (ViewBag.Comments != null && ViewBag.Comments.Count > 0)
        {
            <ul class="space-y-4">
                @foreach (var comment in ViewBag.Comments)
                {
                    <li class="p-4 rounded-2xl shadow-sm border bg-white/80 backdrop-blur">
                        <div class="flex items-center gap-2 mb-1">
                            <strong class="text-gray-900">@comment.username</strong>
                            <span class="text-gray-400 text-sm">• @comment.Date</span>
                        </div>
                        <p class="text-gray-700 leading-relaxed">
                            @comment.Text
                        </p>
                    </li>
                }
            </ul>
        }
        else
        {
            <p class="text-gray-500">No comments yet. Be the first to speak ✨</p>
        }
    </div>

    <hr class="my-8" />

    <!-- BACK -->
    <a asp-controller="Home"
       asp-action="Index"
       class="inline-flex items-center gap-2 text-lg font-semibold text-gray-600 hover:text-black transition">
        ← Back to All Topics
    </a>

</div>
