@using System.Text.RegularExpressions
@model IEnumerable<Post>

<!-- PAGE HEADER -->
<div class="mb-8 mt-3">
    <h1 class="text-3xl md:text-3xl font-bold tracking-tight">
        Search Results 🔍
    </h1>
    <p class="text-gray-500 mt-2 text-lg">
        Find posts that match your curiosity.
    </p>
</div>

<!-- SEARCH BAR -->
<form asp-action="Search"
      asp-controller="Home"
      method="get"
      class="mb-10">

    <div class="relative max-w-xl">
        <input type="text"
               name="title"
               placeholder="Search posts, topics, keywords..."
               class="w-full rounded-full border-2 border-gray-200 px-6 py-4 text-lg shadow-sm
                      focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200
                      transition-all duration-200" />

        <button type="submit"
                class="absolute right-2 top-1/2 -translate-y-1/2
                       bg-indigo-600 hover:bg-indigo-700
                       text-white rounded-full p-3
                       shadow-lg hover:shadow-xl transition-all">
            🔍
        </button>
    </div>
</form>

<!-- RESULTS -->
@if (Model != null && Model.Any())
{
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        @foreach (var data in Model)
        {
            <div class="group bg-white/80 backdrop-blur rounded-3xl shadow-lg hover:shadow-2xl transition-all duration-300 flex flex-col">

                <div class="p-6 flex flex-col flex-grow">
                    <h3 class="text-xl font-bold mb-2 group-hover:text-indigo-600 transition">
                        @data.Title
                    </h3>

                    <p class="text-gray-600 leading-relaxed flex-grow">
                        @{
                            var match = Regex.Match(data.Description ?? "", "<p>(.*?)</p>", RegexOptions.Singleline);
                            var firstPara = match.Success ? match.Groups[1].Value : data.Description ?? "";
                            var plain = Regex.Replace(firstPara, "<.*?>", "").Replace("&nbsp;", " ").Trim();
                            var shortText = plain.Length > 120 ? plain.Substring(0, 120) + "..." : plain;
                        }
                        @shortText
                    </p>

                    <div class="mt-4 text-sm text-gray-500">
                        <span class="font-semibold text-gray-700">@data.Username</span>
                        <span class="mx-1">•</span>
                        👁️ @data.ViewCount
                        <span class="mx-1">•</span>
                        👍 @data.LikeCount
                    </div>
                </div>

                <div class="px-6 pb-6">
                    <a asp-controller="Home"
                       asp-action="ReadMore"
                       asp-route-id="@data.Post_Id"
                       class="inline-flex items-center justify-center w-full
                                      rounded-full bg-gray-900 text-white py-2.5
                                      font-semibold hover:bg-black transition">
                        Read More →
                    </a>
                </div>

            </div>
        }
    </div>
}
else
{
    <div class="mt-12 text-center text-gray-500 text-lg">
        No results found. Try a different keyword ✨
    </div>
}
